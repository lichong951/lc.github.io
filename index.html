<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="读书笔记；移动开发；node.js">
<meta property="og:type" content="website">
<meta property="og:title" content="Lc">
<meta property="og:url" content="https://lichong951.github.io/index.html">
<meta property="og:site_name" content="Lc">
<meta property="og:description" content="读书笔记；移动开发；node.js">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lc">
<meta name="twitter:description" content="读书笔记；移动开发；node.js">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://lichong951.github.io/">





  <title>Lc</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?182a59a031a7cdcc77ab75af4f61bb5b";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Lc</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">lichong博客</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://lichong951.github.io/2019/07/15/serial-prot-helper/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lichong">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lc">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/15/serial-prot-helper/" itemprop="url">串口工具</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-15T14:26:28+08:00">
                2019-07-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line">import android.text.TextUtils;</span><br><span class="line">import android.util.Log;</span><br><span class="line"></span><br><span class="line">import com.deemons.serialportlib.SerialPort;</span><br><span class="line">import com.glodon.tool.DataUtils;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.concurrent.CopyOnWriteArrayList;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 串口帮助类</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * 使用简述</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * 添加库：implementation &quot;com.deemons.serialport:serialport:1.2.0&quot;</span><br><span class="line"> *</span><br><span class="line"> * @see</span><br><span class="line"> * &lt;a href=“https://github.com/Deemonser/AndroidSerialPort”&gt;https://github.com/Deemonser/AndroidSerialPort&lt;/a&gt;</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * @see</span><br><span class="line"> * &lt;a href=“http://pm.glodon.com/newjira/browse/GLW-1234”&gt;通信协议：http://pm.glodon.com/newjira/browse/GLW-1234&lt;/a&gt;</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * Created by lichongmac@163.com on 2019-07-12.</span><br><span class="line"> */</span><br><span class="line">public class SerialPortHelper &#123;</span><br><span class="line">    private static final String TAG = SerialPortHelper.class.getSimpleName();</span><br><span class="line"></span><br><span class="line">    private SerialPort mSerialPort;</span><br><span class="line"></span><br><span class="line">    private String filePath = &quot;/dev/ttyS2&quot;;</span><br><span class="line">    private int baudRate = 115200;</span><br><span class="line"></span><br><span class="line">    private static SerialPortHelper sSerialPortHelper;</span><br><span class="line"></span><br><span class="line">    private SerialPortHelper() &#123;</span><br><span class="line">        openSerialPort();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void openSerialPort() &#123;</span><br><span class="line">        closeSerialPort();</span><br><span class="line">        try &#123;</span><br><span class="line">            mSerialPort = new SerialPort(filePath, baudRate);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        new ReceiveThread().start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static SerialPortHelper getInstance() &#123;</span><br><span class="line">        if (sSerialPortHelper == null) &#123;</span><br><span class="line">            sSerialPortHelper = new SerialPortHelper();</span><br><span class="line">        &#125;</span><br><span class="line">        return sSerialPortHelper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void closeSerialPort() &#123;</span><br><span class="line">        if (mSerialPort != null) &#123;</span><br><span class="line">            isStart = false;</span><br><span class="line">            mSerialPort.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private boolean isStart = false;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 接收串口数据的线程</span><br><span class="line">     */</span><br><span class="line">    private class ReceiveThread extends Thread &#123;</span><br><span class="line"></span><br><span class="line">        public ReceiveThread() &#123;</span><br><span class="line">            isStart = true;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private String dataBuffer = &quot;&quot;;</span><br><span class="line">        private String CMD_HEADER = &quot;BB&quot;;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            super.run();</span><br><span class="line">            //条件判断，只要条件为true，则一直执行这个线程</span><br><span class="line">            while (isStart) &#123;</span><br><span class="line">                if (mSerialPort.getInputStream() == null) &#123;</span><br><span class="line">                    Log.e(TAG, &quot;数据流出现未知异常&quot;);</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                byte[] readData = new byte[1024];</span><br><span class="line">                try &#123;</span><br><span class="line">                    int size = mSerialPort.getInputStream().read(readData);</span><br><span class="line">                    if (size &gt; 0) &#123;</span><br><span class="line"></span><br><span class="line">                        String data = DataUtils.ByteArrToHex(readData, 0, size);</span><br><span class="line">                        if (!TextUtils.isEmpty(data)) &#123;</span><br><span class="line">                            Log.i(TAG, data);</span><br><span class="line">                            dataBuffer += data;</span><br><span class="line">                        &#125;</span><br><span class="line">                        while (dataBuffer.contains(CMD_HEADER) &amp;&amp; dataBuffer.length() &gt; 10) &#123;</span><br><span class="line">//                            Log.i(TAG, &quot;start dataBuffer = &quot; + dataBuffer);</span><br><span class="line">                            int start = dataBuffer.indexOf(CMD_HEADER) + CMD_HEADER.length();</span><br><span class="line">                            String msgType = dataBuffer.substring(start, start + 2);</span><br><span class="line">                            String msgComm = dataBuffer.substring(start + 2, start + 4);</span><br><span class="line">                            String contentLength = dataBuffer.substring(start + 4, start + 8);</span><br><span class="line"></span><br><span class="line">                            int length = DataUtils.HexToInt(contentLength);</span><br><span class="line"></span><br><span class="line">                            if (start + 8 + length * 2 &gt; dataBuffer.length())</span><br><span class="line">                                break;</span><br><span class="line"></span><br><span class="line">                            String content = dataBuffer.substring(start + 8,</span><br><span class="line">                                    start + 8 + length * 2);</span><br><span class="line">                            Log.i(TAG, &quot;消息类型：&quot; + msgType</span><br><span class="line">                                    + &quot;，指令：&quot; + msgComm</span><br><span class="line">                                    + &quot;，数据长度：&quot; + length</span><br><span class="line">                                    + &quot;，content：&quot; + content</span><br><span class="line">                            );</span><br><span class="line">                            //通知观察者或监听者消息内容</span><br><span class="line">                            SerialPortHelper.getInstance().notify(msgType, msgComm, content);</span><br><span class="line"></span><br><span class="line">                            dataBuffer = dataBuffer.substring(start + 8 + length * 2);</span><br><span class="line">                            if (dataBuffer.contains(CMD_HEADER)) &#123;//剔除尾部和校验位</span><br><span class="line">                                dataBuffer = dataBuffer.substring(dataBuffer.indexOf(CMD_HEADER));</span><br><span class="line">                            &#125;</span><br><span class="line">//                            Log.i(TAG, &quot;end dataBuffer = &quot; + dataBuffer);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public interface SerialPortListener &#123;</span><br><span class="line">        void onReceive(String msgType, String msgComm, String content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    List&lt;SerialPortListener&gt; mListeners = new CopyOnWriteArrayList();</span><br><span class="line"></span><br><span class="line">    public void addListener(SerialPortListener listener) &#123;</span><br><span class="line">        if (!mListeners.contains(listener)) &#123;</span><br><span class="line">            mListeners.add(listener);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void removeListener(SerialPortListener listener) &#123;</span><br><span class="line">        if (mListeners.contains(listener)) &#123;</span><br><span class="line">            mListeners.remove(listener);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void notify(String msgType, String msgComm, String content) &#123;</span><br><span class="line">        for (SerialPortListener listener : mListeners)</span><br><span class="line">            listener.onReceive(msgType, msgComm, content);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="辅助类"><a href="#辅助类" class="headerlink" title="辅助类"></a>辅助类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line">import android.text.TextUtils;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 串口数据转换工具类</span><br><span class="line"> * Created by Administrator on 2016/6/2.</span><br><span class="line"> */</span><br><span class="line">public class DataUtils &#123;</span><br><span class="line">    //-------------------------------------------------------</span><br><span class="line">    // 判断奇数或偶数，位运算，最后一位是1则为奇数，为0是偶数</span><br><span class="line">    public static int isOdd(int num) &#123;</span><br><span class="line">        return num &amp; 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //-------------------------------------------------------</span><br><span class="line">    //Hex字符串转int</span><br><span class="line">    public static int HexToInt(String inHex) &#123;</span><br><span class="line">        if(TextUtils.isEmpty(inHex)) &#123;</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">        try &#123;</span><br><span class="line"></span><br><span class="line">        return Integer.parseInt(inHex, 16);</span><br><span class="line">        &#125;catch (NumberFormatException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static String IntToHex(int intHex)&#123;</span><br><span class="line">        return Integer.toHexString(intHex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //-------------------------------------------------------</span><br><span class="line">    //Hex字符串转byte</span><br><span class="line">    public static byte HexToByte(String inHex) &#123;</span><br><span class="line">        return (byte) Integer.parseInt(inHex, 16);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //-------------------------------------------------------</span><br><span class="line">    //1字节转2个Hex字符</span><br><span class="line">    public static String Byte2Hex(Byte inByte) &#123;</span><br><span class="line">        return String.format(&quot;%02x&quot;, new Object[]&#123;inByte&#125;).toUpperCase();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //-------------------------------------------------------</span><br><span class="line">    //字节数组转转hex字符串</span><br><span class="line">    public static String ByteArrToHex(byte[] inBytArr) &#123;</span><br><span class="line">        StringBuilder strBuilder = new StringBuilder();</span><br><span class="line">        for (byte valueOf : inBytArr) &#123;</span><br><span class="line">            strBuilder.append(Byte2Hex(Byte.valueOf(valueOf)));</span><br><span class="line">            strBuilder.append(&quot; &quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return strBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //-------------------------------------------------------</span><br><span class="line">    //字节数组转转hex字符串，可选长度</span><br><span class="line">    public static String ByteArrToHex(byte[] inBytArr, int offset, int byteCount) &#123;</span><br><span class="line">        StringBuilder strBuilder = new StringBuilder();</span><br><span class="line">        int j = byteCount;</span><br><span class="line">        for (int i = offset; i &lt; j; i++) &#123;</span><br><span class="line">            strBuilder.append(Byte2Hex(Byte.valueOf(inBytArr[i])));</span><br><span class="line">        &#125;</span><br><span class="line">        return strBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ascii byte数 组转成String字符串，可选长度</span><br><span class="line">    public static String byteOfASCIIToString(byte[] inBytArr, int offset, int byteCount)&#123;</span><br><span class="line">        StringBuilder strBuilder = new StringBuilder();</span><br><span class="line">        int j = byteCount;</span><br><span class="line">        for (int i = offset; i &lt; j; i++) &#123;</span><br><span class="line">            char c=(char)inBytArr[i];</span><br><span class="line">            strBuilder.append(c);</span><br><span class="line">        &#125;</span><br><span class="line">        return strBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //-------------------------------------------------------</span><br><span class="line">    //转hex字符串转字节数组</span><br><span class="line">    public static byte[] HexToByteArr(String inHex) &#123;</span><br><span class="line">        byte[] result;</span><br><span class="line">        int hexlen = inHex.length();</span><br><span class="line">        if (isOdd(hexlen) == 1) &#123;</span><br><span class="line">            hexlen++;</span><br><span class="line">            result = new byte[(hexlen / 2)];</span><br><span class="line">            inHex = &quot;0&quot; + inHex;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            result = new byte[(hexlen / 2)];</span><br><span class="line">        &#125;</span><br><span class="line">        int j = 0;</span><br><span class="line">        for (int i = 0; i &lt; hexlen; i += 2) &#123;</span><br><span class="line">            result[j] = HexToByte(inHex.substring(i, i + 2));</span><br><span class="line">            j++;</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 按照指定长度切割字符串</span><br><span class="line">     *</span><br><span class="line">     * @param inputString 需要切割的源字符串</span><br><span class="line">     * @param length      指定的长度</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public static List&lt;String&gt; getDivLines(String inputString, int length) &#123;</span><br><span class="line">        List&lt;String&gt; divList = new ArrayList&lt;&gt;();</span><br><span class="line">        int remainder = (inputString.length()) % length;</span><br><span class="line">        // 一共要分割成几段</span><br><span class="line">        int number = (int) Math.floor((inputString.length()) / length);</span><br><span class="line">        for (int index = 0; index &lt; number; index++) &#123;</span><br><span class="line">            String childStr = inputString.substring(index * length, (index + 1) * length);</span><br><span class="line">            divList.add(childStr);</span><br><span class="line">        &#125;</span><br><span class="line">        if (remainder &gt; 0) &#123;</span><br><span class="line">            String cStr = inputString.substring(number * length, inputString.length());</span><br><span class="line">            divList.add(cStr);</span><br><span class="line">        &#125;</span><br><span class="line">        return divList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 计算长度，两个字节长度</span><br><span class="line">     *</span><br><span class="line">     * @param val value</span><br><span class="line">     * @return 结果</span><br><span class="line">     */</span><br><span class="line">    public static String twoByte(String val) &#123;</span><br><span class="line">        if (val.length() &gt; 4) &#123;</span><br><span class="line">            val = val.substring(0, 4);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            int l = 4 - val.length();</span><br><span class="line">            for (int i = 0; i &lt; l; i++) &#123;</span><br><span class="line">                val = &quot;0&quot; + val;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 校验和</span><br><span class="line">     *</span><br><span class="line">     * @param cmd 指令</span><br><span class="line">     * @return 结果</span><br><span class="line">     */</span><br><span class="line">    public static String sum(String cmd) &#123;</span><br><span class="line">        List&lt;String&gt; cmdList = DataUtils.getDivLines(cmd, 2);</span><br><span class="line">        int sumInt = 0;</span><br><span class="line">        for (String c : cmdList) &#123;</span><br><span class="line">            sumInt += DataUtils.HexToInt(c);</span><br><span class="line">        &#125;</span><br><span class="line">        String sum = DataUtils.IntToHex(sumInt);</span><br><span class="line">        sum = DataUtils.twoByte(sum);</span><br><span class="line">        cmd += sum;</span><br><span class="line">        return cmd.toUpperCase();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static int str8ToInt(String[] str)&#123;</span><br><span class="line">        int sum=0;</span><br><span class="line">        for(int i=0;i&lt;str.length;i++)&#123;</span><br><span class="line"></span><br><span class="line">            int value=computerBinary(str[i],str.length-1-i);</span><br><span class="line"></span><br><span class="line">            sum+=value;</span><br><span class="line">        &#125;</span><br><span class="line">        return sum;</span><br><span class="line">    &#125;</span><br><span class="line">    public static int str8ToInt(String str)&#123;</span><br><span class="line">        int sum=0;</span><br><span class="line">        for(int i=0;i&lt;str.length();i++)&#123;</span><br><span class="line">            String strIndex=str.charAt(i)+&quot;&quot;;</span><br><span class="line">            int value=computerBinary(strIndex,str.length()-1-i);</span><br><span class="line"></span><br><span class="line">            sum+=value;</span><br><span class="line">        &#125;</span><br><span class="line">        return sum;</span><br><span class="line">    &#125;</span><br><span class="line">    private static int computerBinary(String c, int index) &#123;</span><br><span class="line">        int vaule=Integer.valueOf(c);</span><br><span class="line">        for(int i=0;i&lt;index;i++)&#123;</span><br><span class="line">            vaule*=2;</span><br><span class="line">        &#125;</span><br><span class="line">        return vaule;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://github.com/Deemonser/AndroidSerialPort" target="_blank" rel="noopener">GitHub地址</a><br><a href></a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://lichong951.github.io/2019/03/08/DataStructuresAndAlgorlthms/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lichong">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lc">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/08/DataStructuresAndAlgorlthms/" itemprop="url">数据结构和算法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-08T05:30:03+08:00">
                2019-03-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="数据结构和算法"><a href="#数据结构和算法" class="headerlink" title="数据结构和算法"></a>数据结构和算法</h1><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol>
<li>简单的数据结构<ul>
<li>栈、队列、链表、数组、哈希表</li>
<li>栈和队列的相同和不同之处</li>
<li>栈通常采用的两种存储结构 </li>
</ul>
</li>
<li><p>树</p>
<ul>
<li>二叉树、字典树、平衡树、排序树</li>
<li>B 树、B+ 树、R 树、多路树、红黑树</li>
</ul>
</li>
<li><p>堆</p>
<ul>
<li>大根堆、小根堆</li>
</ul>
</li>
<li><p>图</p>
<ul>
<li>有向图、无向图、拓扑</li>
</ul>
</li>
<li><p>排序算法</p>
<ul>
<li>稳定的排序<ul>
<li>冒泡排序</li>
<li>插入排序</li>
<li>鸡尾酒排序</li>
<li>桶排序</li>
<li>计数排序</li>
<li>归并排序</li>
<li>原地归并排序</li>
<li>二叉排序树排序</li>
<li>鸽巢排序</li>
<li>基数排序</li>
<li>侏儒排序</li>
<li>图书馆排序</li>
<li>块排序</li>
</ul>
</li>
<li>不稳定的排序<ul>
<li>选择排序</li>
<li>希尔排序</li>
<li>Clover 排序算法</li>
<li>梳排序</li>
<li>堆排序</li>
<li>平滑排序</li>
<li>快速排序</li>
<li>内省排序</li>
<li>耐心排序  </li>
</ul>
</li>
</ul>
</li>
<li><p>两个栈实现队列，和两个队列实现栈</p>
</li>
<li>深度优先和广度优先搜索</li>
<li>全排列、贪心算法、KMP 算法、hash 算法</li>
<li>海量数据处理<ul>
<li>分治，hash 映射，堆排序，双层桶划分，Bloom Filter，bitmap，数据库索引，mapreduce </li>
</ul>
</li>
</ol>
<h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><h3 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h3><p>栈是一种“先进后出”的一种数据结构，有压栈出栈两种操作方式</p>
<h4 id="栈的分类"><a href="#栈的分类" class="headerlink" title="栈的分类"></a>栈的分类</h4><p>栈主要分为两类：</p>
<ul>
<li>静态栈</li>
<li>动态栈</li>
</ul>
<p><strong>【静态栈】</strong></p>
<p>静态栈的核心是数组，类似于一个连续内存的数组，我们只能操作其栈顶元素。</p>
<p><strong>【动态栈】</strong></p>
<p>静态栈的核心是数组，类似于一个连续内存的数组，我们只能操作其栈顶节点。<br><img src="../pic/stack01.png" alt="MacDown logo"></p>
<h4 id="栈的算法"><a href="#栈的算法" class="headerlink" title="栈的算法"></a>栈的算法</h4><p>首先要明白以下思路：</p>
<ul>
<li>栈操作的是一个一个节点</li>
<li>栈本身也是一种存储的数据结构</li>
<li>栈有初始化、压栈、出栈、判空、遍历、清空等主要方法</li>
</ul>
<h4 id="栈的应用"><a href="#栈的应用" class="headerlink" title="栈的应用"></a>栈的应用</h4><ul>
<li>数制转换</li>
<li>括号匹配的检验<h4 id="栈通常采用的两种存储结构"><a href="#栈通常采用的两种存储结构" class="headerlink" title="栈通常采用的两种存储结构"></a>栈通常采用的两种存储结构</h4><h4 id="参考地址"><a href="#参考地址" class="headerlink" title="参考地址"></a>参考地址</h4></li>
<li><a href="https://www.cnblogs.com/xiaoyouPrince/p/8082640.html" target="_blank" rel="noopener">https://www.cnblogs.com/xiaoyouPrince/p/8082640.html</a></li>
</ul>
<h3 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h3><h4 id="栈和队列的相同与不同"><a href="#栈和队列的相同与不同" class="headerlink" title="栈和队列的相同与不同"></a>栈和队列的相同与不同</h4><h3 id="链表"><a href="#链表" class="headerlink" title="链表"></a>链表</h3><h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><h3 id="哈希表"><a href="#哈希表" class="headerlink" title="哈希表"></a>哈希表</h3><p><img src="../pic/me.jpg" alt="MacDown logo"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://lichong951.github.io/2018/05/13/【Jenkins】构建后生成下载二维码并邮件通知/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lichong">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lc">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/13/【Jenkins】构建后生成下载二维码并邮件通知/" itemprop="url">【Jenkins】构建后生成下载二维码并邮件通知</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-13T15:18:25+08:00">
                2018-05-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="二维码生成配置"><a href="#二维码生成配置" class="headerlink" title="二维码生成配置"></a>二维码生成配置</h3><h4 id="http-server-MAC"><a href="#http-server-MAC" class="headerlink" title="http-server(MAC)"></a>http-server(MAC)</h4><p>检测 node -v、npm -v 然后安装http-server</p>
<pre><code>npm install http-server -g
</code></pre><p>启动服务“http-server -p 8000” 设置端口为8000.避免jenkins端口冲突<br>在/Users/XXX/Public 目录下面建立jenkins目录，把构建后的apk复制到/Users/XXX/Public/jenkins/apk/目录下面<br>然后把二维码图片也复制到/Users/XXX/Public/jenkins</p>
<blockquote>
<p>为什么要http-server服务</p>
</blockquote>
<p>因为在jenkins里的图片在邮件里是没有办法直接显示的。必须要有一个没有拦截的访问路径。以避开jenkins的用户验证。同理apk的下载也是如此<br>不过一般都是部署在局域网内。安全性还是有保障的。如果要发布到外网的可以使用第三方服务上传apk包生成公网下载二维码。</p>
<h4 id="安装pip（MAC）（python-gt-3-1）-如果版本不够看”其他“"><a href="#安装pip（MAC）（python-gt-3-1）-如果版本不够看”其他“" class="headerlink" title="安装pip（MAC）（python&gt;3.1）[如果版本不够看”其他“]"></a>安装pip（MAC）（python&gt;3.1）[如果版本不够看”其他“]</h4><pre><code>sudo easy_install pip
</code></pre><p><a href="https://jingyan.baidu.com/article/ca2d939d6299eaeb6c31cee2.html" target="_blank" rel="noopener">mac下安装pip</a></p>
<p><a href="http://www.cnblogs.com/yuanzm/p/4089856.html" target="_blank" rel="noopener">windows下面安装Python和pip终极教程</a></p>
<h4 id="安装myqr"><a href="#安装myqr" class="headerlink" title="安装myqr"></a>安装myqr</h4><pre><code>命令1：pip install Pillow （失败）
命令2：pip install -I --no-cache-dir -v Pillow （成功）
至于为什么失败，解释颇多也不想深究。暂且都记上多试试。
安装qrcode 命令：pip install myqr
</code></pre><p>生成二维码命令<br>    myqr <a href="http://localhost:8000/jenkins/apk/XXXX.apk" target="_blank" rel="noopener">http://localhost:8000/jenkins/apk/XXXX.apk</a> -n jenkins-qrcode-${JOB_NAME}.png -v 1 -l L -d /Users/XXX/Public/jenkins</p>
<h3 id="Jenkins邮件通知配置"><a href="#Jenkins邮件通知配置" class="headerlink" title="Jenkins邮件通知配置"></a>Jenkins邮件通知配置</h3><p>在邮件配置content字段里添加</p>
<pre><code>&lt;img src=&quot;http://localhost:8000/jenkins/jenkins-qrcode-${JOB_NAME}.png &quot; width=&quot;200px&quot; height=&quot;200px&quot; /&gt;&lt;/br&gt;&lt;/hr&gt;
&lt;a href=&apos;http://localhost:8000/jenkins/apk/XXXX.apk&apos;&gt;点击下载apk&lt;/a&gt;
</code></pre><p>邮件通知配置样例<br>    <hr></p>
<pre><code>(本邮件是程序自动下发的，请勿回复！)&lt;br/&gt;&lt;hr/&gt;

项目名称：$PROJECT_NAME&lt;br/&gt;&lt;hr/&gt;

构建编号：$BUILD_NUMBER&lt;br/&gt;&lt;hr/&gt;

构建状态：$BUILD_STATUS&lt;br/&gt;&lt;hr/&gt;

触发原因：${CAUSE}&lt;br/&gt;&lt;hr/&gt;

扫描二维码下载&lt;img src=&quot;http://192.168.10.214:8000/JenkinsApk/jenkins-qrcode-${JOB_NAME}.png&quot; width=&quot;200px&quot; height=&quot;200px&quot;/&gt; &lt;br/&gt;&lt;hr/&gt;
&lt;a href=&quot;http://192.168.10.214:8000/JenkinsApk/apk/${JOB_NAME}-Debug-${BUILD_NUMBER}.apk&quot;&gt;点击下载${JOB_NAME}-Debug-${BUILD_NUMBER}.apk&lt;/a&gt;&lt;br/&gt;&lt;hr/&gt;
构建日志地址：&lt;a href=&quot;${BUILD_URL}console&quot;&gt;${BUILD_URL}console&lt;/a&gt;&lt;br/&gt;&lt;hr/&gt;

构建地址：&lt;a href=&quot;$BUILD_URL&quot;&gt;$BUILD_URL&lt;/a&gt;&lt;br/&gt;&lt;hr/&gt;

变更集:${JELLY_SCRIPT,template=&quot;html&quot;}&lt;br/&gt;&lt;hr/&gt;
</code></pre><p>参考：<br><a href="https://www.jianshu.com/p/915c1ae69144" target="_blank" rel="noopener">https://www.jianshu.com/p/915c1ae69144</a></p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>【MAC】</p>
<blockquote>
<p>“OSError: [Errno 13] Permission denied: ‘/Library/Python/2.7/site-packages/PIL’”</p>
</blockquote>
<p><strong>使用 sudo pip install -I –no-cache-dir -v Pillow 命令安装</strong></p>
<blockquote>
<p>mac OSError: [Errno 1] Operation not permitted: ‘/tmp/pip-ZaNR4Q-uninstall/System/Library/Frameworks</p>
</blockquote>
<p>升级python 版本</p>
<pre><code>$ pip install --upgrade pip
$ sudo pip install numpy --upgrade --ignore-installed
$ sudo pip install scipy --upgrade --ignore-installed
$ sudo pip install scikit-learn --upgrade --ignore-installed
</code></pre><p>参考<a href="https://www.jianshu.com/p/7a18c78b5982" target="_blank" rel="noopener">https://www.jianshu.com/p/7a18c78b5982</a></p>
<blockquote>
<p>OSError: [Errno 13] Permission denied: ‘/Library/Python/2.7/site-packages/imageio-2.3.0.dist-info’<br>解决方法：<br><strong>sudo pip install myqr</strong></p>
</blockquote>
<blockquote>
<p>matplotlib 1.3.1 requires nose, which is not installed.<br>matplotlib 1.3.1 requires tornado, which is not installed.</p>
</blockquote>
<p>解决方法：运行sudo pip install matplotlib</p>
<h2 id="联系我"><a href="#联系我" class="headerlink" title="联系我"></a>联系我</h2><blockquote>
<p>Email:<a href="mailto:lichongmac@163.com" target="_blank" rel="noopener">lichongmac@163.com</a></p>
</blockquote>
<p>支付宝打赏：<a href="https://pan.baidu.com/s/1UMWjU1FHv7hYpdlcCQrJ3A" target="_blank" rel="noopener">https://pan.baidu.com/s/1UMWjU1FHv7hYpdlcCQrJ3A</a></p>
<p>微信打赏：<a href="https://pan.baidu.com/s/1dSBXk3eFZu3mAMkw3xu9KQ" target="_blank" rel="noopener">https://pan.baidu.com/s/1dSBXk3eFZu3mAMkw3xu9KQ</a></p>
<p>公众号推荐：</p>
<p><img src="http://i2.51cto.com/images/blog/201805/11/0e2ece55187caabd7b246e9550a8d5a0.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://lichong951.github.io/2018/05/13/Jenkins01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lichong">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lc">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/13/Jenkins01/" itemprop="url">【Jenkins】自动构建配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-13T15:10:46+08:00">
                2018-05-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="时间设置说明"><a href="#时间设置说明" class="headerlink" title="时间设置说明"></a>时间设置说明</h3><pre><code>* * * * *
(五颗星，中间用空格隔开）
第一颗*表示分钟，取值0~59
第二颗*表示小时，取值0~23
第三颗*表示一个月的第几天，取值1~31
第四颗*表示第几月，取值1~12
第五颗*表示一周中的第几天，取值0~7，其中0和7代表的都是周日
</code></pre><p>例子如下：</p>
<pre><code>每15分钟构建一次：H/15 * * * *   或*/5 * * * *
每天8点构建一次：0 8 * * *
每天8点~17点，两小时构建一次：0 8-17/2 * * *
周一到周五，8点~17点，两小时构建一次：0 8-17/2 * * 1-5
每月1号、15号各构建一次，除12月：H H 1,15 1-11 *
*/5 * * * * （每5分钟检查一次源码变化）
0 2 * * * （每天2:00 必须build一次源码）
</code></pre><h3 id="触发远程构建-例如-使用脚本"><a href="#触发远程构建-例如-使用脚本" class="headerlink" title="触发远程构建 例如,使用脚本"></a>触发远程构建 例如,使用脚本</h3><h3 id="Build-after-other-projects-are-built"><a href="#Build-after-other-projects-are-built" class="headerlink" title="Build after other projects are built"></a>Build after other projects are built</h3><p>Projects to watch “XXXXX”</p>
<pre><code>* Trigger only if build is stable：只有在构建稳定时才触发
* 
* Trigger even if the build is unstable：即使构建不稳定，也要触发
* 
* Trigger even if the build fails：即使构建失败，也要触发
* 
</code></pre><h3 id="Build-periodically"><a href="#Build-periodically" class="headerlink" title="Build periodically"></a>Build periodically</h3><p>周期性进行项目构建，这个是到指定的时间必须触发构建任务<br>比如我想在每天的9点，17点，朝九晚五各构建一次，在Build periodically里设置如下<br><img src="http://i2.51cto.com/images/blog/201803/26/9bafd3a8ed881183ce75f56363f54270.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt></p>
<h3 id="Build-when-a-change-is-pushed-to-GitLab-GitLab-CI-Service-URL-XXXXX"><a href="#Build-when-a-change-is-pushed-to-GitLab-GitLab-CI-Service-URL-XXXXX" class="headerlink" title="Build when a change is pushed to GitLab. GitLab CI Service URL: XXXXX"></a>Build when a change is pushed to GitLab. GitLab CI Service URL: XXXXX</h3><ul>
<li>Enabled GitLab triggers    ：启用GitLab触发器</li>
<li>Push Events：push 事件</li>
<li>Opened Merge Request Events：打开合并请求事件</li>
<li>Accepted Merge Request Events        ：接受合并请求事件</li>
<li>Closed Merge Request Events        ：关闭合并请求事件</li>
<li>Rebuild open Merge Requests        ：重建开放合并请求</li>
<li>Comments        ：评论</li>
<li>Comment for triggering a build：注释触发构建</li>
</ul>
<h3 id="GitHub-hook-trigger-for-GITScm-polling"><a href="#GitHub-hook-trigger-for-GITScm-polling" class="headerlink" title="GitHub hook trigger for GITScm polling"></a>GitHub hook trigger for GITScm polling</h3><p>GitHub钩子触发GITScm轮询</p>
<h3 id="Poll-SCM"><a href="#Poll-SCM" class="headerlink" title="Poll SCM"></a>Poll SCM</h3><p>1.Poll SCM:定时检查源码变更（根据SCM软件的版本号），如果有更新就checkout最新code下来，然后执行构建动作</p>
<p>2.如果我想每隔30分钟（H/30 <em> </em> <em> </em>）检查一次源码变化，有变化就执行</p>
<p>Ignore post-commit hooks(可选项):忽略post-commit钩子</p>
<h2 id="联系我"><a href="#联系我" class="headerlink" title="联系我"></a>联系我</h2><blockquote>
<p>Email:<a href="mailto:lichongmac@163.com" target="_blank" rel="noopener">lichongmac@163.com</a></p>
</blockquote>
<p>支付宝打赏：<a href="https://pan.baidu.com/s/1UMWjU1FHv7hYpdlcCQrJ3A" target="_blank" rel="noopener">https://pan.baidu.com/s/1UMWjU1FHv7hYpdlcCQrJ3A</a></p>
<p>微信打赏：<a href="https://pan.baidu.com/s/1dSBXk3eFZu3mAMkw3xu9KQ" target="_blank" rel="noopener">https://pan.baidu.com/s/1dSBXk3eFZu3mAMkw3xu9KQ</a></p>
<p>公众号推荐：</p>
<p><img src="http://i2.51cto.com/images/blog/201805/11/0e2ece55187caabd7b246e9550a8d5a0.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://lichong951.github.io/2017/11/18/unity3d-android-debug/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lichong">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lc">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/18/unity3d-android-debug/" itemprop="url">【Unity3D】Android真机断点调试</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-18T15:59:16+08:00">
                2017-11-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="【Unity3D】Android真机断点调试"><a href="#【Unity3D】Android真机断点调试" class="headerlink" title="【Unity3D】Android真机断点调试"></a>【Unity3D】Android真机断点调试</h1><ol>
<li>首先在手机上开启USB调试功能，并安装驱动（这一步很多手机助手都可以完成）</li>
<li>用USB电缆连接手机和电脑</li>
<li>确保手机和电脑在一个局域网内，简单的说就是电脑和手机共用一个路由器，网段一样。</li>
<li><p>打开电脑上CMD窗口，输入以下命令：</p>
<p>  Adb tcpip 5555（该命令打开手机adb网络调试功能）<br> 正常情况下输入命令后控制台会出现回显<br>   restarting in TCP mode port: 5555<br>  打开手机查看手机的IP地址（不会请百度）假设手机的地址是192.168.1.x输入命令<br> adb connect 192.168.1.x<br> 如果一切正常控制台会回显以下内容<br> connected to 192.168.1.x:5555<br> 如果你想查看是否连接成功请输入以下内容<br>   adb devices<br>   控制台会回显连接的设备</p>
</li>
<li><p>如果一切连接成功，请拔掉USB电缆，选择File-&gt;Build&amp;Run，在编译之前要勾选上<br>Development Build 和Script Debugging这两项在build setting里面勾选不要忘记否则是不能调试的）电脑会自动编译文件并将APK推送至手机，在手机上同意并安装</p>
</li>
<li><p>当程序运行后再Monodevelop里面打开Run-&gt;Attach to process 会发现你手机的选项，选择手机，在脚本里面添加断点，你发现可以调试了，那叫一个爽！出现问题再也不用去瞎猜，或者添加Debuglog了</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://lichong951.github.io/2017/05/20/designpattern-state1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lichong">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lc">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/20/designpattern-state1/" itemprop="url">【设计模式】Java状态模式（1）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-20T21:41:22+08:00">
                2017-05-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>State的定义：不同的状态，不同的行为；或者说，每个状态有着相应的行为</p>
<h2 id="何时使用状态模式"><a href="#何时使用状态模式" class="headerlink" title="何时使用状态模式"></a>何时使用状态模式</h2><p>State模式在实际使用中比较多，适合”状态的切换”。因为我们经常会使用If elseif else 进行状态切换， 如果针对状态的这样判断切换反复出现，我们就要联想到是否可以采取State模式了。</p>
<p>不只是根据状态，也有根据属性。如果某个对象的属性不同，对象的行为就不一样，这点在数据库系统中出现频率比较高，我们经常会在一个数据表的尾部，加上property属性含义的字段，用以标识记录中一些特殊性质的记录，这种属性的改变(切换)又是随时可能发生的，就有可能要使用State。</p>
<p>在实际使用，类似开关一样的状态切换是很多的，但有时并不是那么明显，取决于你的经验和对系统的理解深度。</p>
<p>这里要阐述的是”开关切换状态” 和” 一般的状态判断”是有一些区别的，” 一般的状态判断”也是有 if..elseif结构，例如：</p>
<pre><code>if (which==1) state=&quot;hello&quot;;
else if (which==2) state=&quot;hi&quot;;
else if (which==3) state=&quot;bye&quot;;
</code></pre><p>这是一个 “ 一般的状态判断”，state值的不同是根据which变量来决定的，which和state没有关系。如果改成：</p>
<pre><code>if (state.euqals(&quot;bye&quot;)) state=&quot;hello&quot;;
　else if (state.euqals(&quot;hello&quot;)) state=&quot;hi&quot;;
　else if (state.euqals(&quot;hi&quot;)) state=&quot;bye&quot;;
</code></pre><p>这就是 “开关切换状态”，是将state的状态从”hello”切换到”hi”，再切换到””bye”；在切换到”hello”，好象一个旋转开关，这种状态改变就可以使用State模式了。</p>
<p>如果单纯有上面一种将”hello”–&gt;”hi”–&gt;”bye”–&gt;”hello”这一个方向切换，也不一定需要使用State模式，因为State模式会建立很多子类，复杂化，但是如果又发生另外一个行为：将上面的切换方向反过来切换，或者需要任意切换，就需要State了。</p>
<p>请看下例：</p>
<pre><code>public class Context{
　　private Color state=null;
　　public void push(){
　　　　//如果当前red状态 就切换到blue
　　　　if (state==Color.red) state=Color.blue;
　　　　//如果当前blue状态 就切换到green
　　　　else if (state==Color.blue) state=Color.green;
　　　　//如果当前black状态 就切换到red
　　　　else if (state==Color.black) state=Color.red;
　　　　//如果当前green状态 就切换到black
　　　　else if (state==Color.green) state=Color.black;
　　　　Sample sample=new Sample(state);
　　　　sample.operate();
　　}
　　public void pull(){
　　　　//与push状态切换正好相反
　　　　if (state==Color.green) state=Color.blue;
　　　　else if (state==Color.black) state=Color.green;
　　　　else if (state==Color.blue) state=Color.red;
　　　　else if (state==Color.red) state=Color.black;
　　　　Sample2 sample2=new Sample2(state);
　　　　sample2.operate();
　　}
}
</code></pre><p>在上例中，我们有两个动作push推和pull拉，这两个开关动作，改变了Context颜色，至此，我们就需要使用State模式优化它。</p>
<p>另外注意：但就上例,state的变化，只是简单的颜色赋值，这个具体行为是很简单的，State适合巨大的具体行为，因此在,就本例，实际使用中也不一定非要使用State模式，这会增加子类的数目，简单的变复杂。</p>
<p>例如：银行帐户，经常会在Open 状态和Close状态间转换。</p>
<p>例如：经典的TcpConnection，Tcp的状态有创建 侦听 关闭三个，并且反复转换，其创建 侦听 关闭的具体行为不是简单一两句就能完成的，适合使用State。</p>
<p>例如：信箱POP帐号，会有四种状态，start HaveUsername Authorized quit，每个状态对应的行为应该是比较大的，适合使用State。</p>
<p>例如：在工具箱挑选不同工具，可以看成在不同工具中切换，适合使用State。如 具体绘图程序，用户可以选择不同工具绘制方框 直线 曲线，这种状态切换可以使用State。</p>
<h2 id="如何使用状态模式"><a href="#如何使用状态模式" class="headerlink" title="如何使用状态模式"></a>如何使用状态模式</h2><p>State需要两种类型实体参与：<br>state manager 状态管理器，就是开关，如上面例子的Context实际就是一个state manager，在state manager中有对状态的切换动作。<br>用抽象类或接口实现的父类，不同状态就是继承这个父类的不同子类。<br>以上面的Context为例，我们要修改它，建立两个类型的实体。</p>
<p>第一步，首先建立一个父类：</p>
<pre><code>package top.lc951.state1;

public abstract class  State {
    public abstract void handlepush(Context c);
    public abstract  void handlepull(Context c);
    public abstract String getColor();

}
</code></pre><p>父类中的方法要对应state manager中的开关行为，在state manager中 本例就是Context中，有两个开关动作push推和pull拉.那么在状态父类中就要有具体处理这两个动作：handlepush() handlepull()；同时还需要一个获取push或pull结果的方法getcolor()。</p>
<p>下面是具体子类的实现：</p>
<pre><code>package top.lc951.state1;

public class BlueState extends State {


@Override
public void handlepush(Context c) {
    // TODO Auto-generated method stub
    c.setState(new GreenState());

}

@Override
public void handlepull(Context c) {
    // TODO Auto-generated method stub
    c.setState(new RedState());

}

@Override
public String getColor() {
    // TODO Auto-generated method stub
    return &quot;blue&quot;;

}
</code></pre><p>}</p>
<p>同样，其他状态的子类实现如blue一样。</p>
<p>第二步，要重新改写State manager 也就是本例的Context</p>
<pre><code>public class Context{
　private Sate state=null; //我们将原来的 Color state 改成了新建的State state;
　//setState是用来改变state的状态 使用setState实现状态的切换
　pulic void setState(State state){
　　　　this.state=state;
　}
　public void push(){
　　//状态的切换的细节部分,在本例中是颜色的变化,已经封装在子类的handlepush中实现,这里无需关心
　　state.handlepush(this);
　　//因为sample要使用state中的一个切换结果,使用getColor()
　　Sample sample=new Sample(state.getColor());
　　sample.operate();
　}
　public void pull(){
　　state.handlepull(this);
　　Sample2 sample2=new Sample2(state.getColor());
　　sample2.operate();
　}
}
</code></pre><p>至此，我们也就实现了State的refactorying过程。</p>
<h3 id="源码地址https-github-com-lichong951-designpattern-lichong951-git"><a href="#源码地址https-github-com-lichong951-designpattern-lichong951-git" class="headerlink" title="源码地址https://github.com/lichong951/designpattern-lichong951.git"></a>源码地址<a href="https://github.com/lichong951/designpattern-lichong951.git" target="_blank" rel="noopener">https://github.com/lichong951/designpattern-lichong951.git</a></h3><p>参考：<a href="http://www.cnblogs.com/Coda/p/4312281.html" target="_blank" rel="noopener">http://www.cnblogs.com/Coda/p/4312281.html</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://lichong951.github.io/2017/04/27/resume/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lichong">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lc">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/27/resume/" itemprop="url">面试总结记录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-27T20:10:01+08:00">
                2017-04-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1、-Android性能分析工具"><a href="#1、-Android性能分析工具" class="headerlink" title="1、 Android性能分析工具"></a>1、 Android性能分析工具</h2><pre><code>1.1 TraceView:
    最简单的方式就是直接打开DDMS，选择一个进程，然后按上面的“Start Method Profiling”按钮，
    第2种方式就是使用android.os.Debug.startMethodTracing();和android.os.Debug.stopMethodTracing();方法
    重要指标 Calls+Recur Calls／Total（方法执行的次数）；Cpu Time／Call（方法耗时）
1.2 Eclipse Memory Analyzer Tool 内存使用

1.3 Dump UI Hierarchy for UI Atomator 分析UI层级

1.4 systrace
    Systrace是Android4.1中新增的性能数据采样和分析工具。它可帮助开发者收集Android关键子系统（如surfaceflinger、WindowManagerService等Framework部分关键模块、服务）的运行信息，从而帮助开发者更直观的分析系统瓶颈，改进性能。
    Systrace的功能包括跟踪系统的I/O操作、内核工作队列、CPU负载以及Android各个子系统的运行状况等。在Android平台中，它主要由3部分组成：
    内核部分：Systrace利用了Linux Kernel中的ftrace功能。所以，如果要使用Systrace的话，必须开启kernel中和ftrace相关的模块。
    数据采集部分：Android定义了一个Trace类。应用程序可利用该类把统计信息输出给ftrace。同时，Android还有一个atrace程序，它可以从ftrace中读取统计信息然后交给数据分析工具来处理。
    数据分析工具：Android提供一个systrace.py（python脚本文件，位于Android SDK目录/tools/systrace中，其内部将调用atrace程序）用来配置数据采集的方式（如采集数据的标签、输出文件名等）和收集ftrace统计数据并生成一个结果网页文件供用户查看。

1.5 Oprofile：性能数据采集和分析工具

1.6 Hierarchy Viewer（层级查看器）
</code></pre><p>参考：<em><a href="http://www.jianshu.com/p/da2a4bfcba68" target="_blank" rel="noopener">http://www.jianshu.com/p/da2a4bfcba68</a></em></p>
<pre><code>1.7 Battery Historian 
    Google出品, 通过Android系统的bugreport文件来做电量使用分析的工具
    https://github.com/google/battery-historian
1.8 NetEase/Emmagee
    针对Android App的CPU, 内存, 网络, 电量等多项综合的测试分析.
    https://github.com/NetEase/Emmagee

1.9 Square
    Square出品, 必属精品.
    类似与App探针的内存泄露监测工具.
    https://github.com/square/leakcanary

1.10 AndroidDevMetrics
    一个library, 用来检测Activity生命周期执行性能, Dagger2注入性能以及帧率性能的工具
    https://github.com/frogermcs/AndroidDevMetrics
</code></pre><p>2、 Android内存优化方案</p>
<pre><code>2.1 Android应用String/StringBuilder/StringBuffer优化建议
字符串操作在Android应用开发中是十分常见的操作，也就是这个最简单的字符串操作却也暗藏很多潜在的性能问题，下面我们实例来说说。
先看下面这个关于String和StringBuffer的对比例子：
//性能差的实现
String str1 = &quot;Name:&quot;;
String str2 = &quot;GJRS&quot;;
String Str = str1 + str2;
//性能好的实现
String str1 = &quot;Name:&quot;;
String str2 = &quot;GJRS&quot;;
StringBuffer str = new StringBuilder().append(str1).append(str2);

通过这个例子可以看出来，String对象（记得是对象，不是常量）和StringBuffer对象的主要性能区别在于String对象是不可变的，所以每次对String对象做改变操作（譬如“+”操作）时其实都生成了新的String对象实例，所以会导致内存消耗性能问题；而StringBuffer对象做改变操作每次都会对自己进行操作，所以不需要消耗额外的内存空间。

我们再看一个关于String和StringBuffer的对比例子：
//性能差的实现
StringBuffer str = new StringBuilder().append(&quot;Name:&quot;).append(&quot;GJRS&quot;);
//性能好的实现
String Str = &quot;Name:&quot; + &quot;GJRS&quot;;
在这种情况下你会发现StringBuffer的性能反而没有String的好，原因是在JVM解释时认为 
String Str = &quot;Name:&quot; + &quot;GJRS&quot;;就是String Str = &quot;Name:GJRS&quot;;，所以自然比StringBuffer快了。
可以发现，如果我们拼接的是字符串常量则String效率比StringBuffer高，如果拼接的是字符串对象，则StringBuffer比String效率高，我们在开发中要酌情选择。当然，除过注意StringBuffer和String的效率问题，我们还应该注意另一个问题，那就是StringBuffer和StringBuilder的区别，其实StringBuffer和StringBuilder都继承自同一个父类，只是StringBuffer是线程安全的，也就是说在不考虑多线程情况下StringBuilder的性能又比StringBuffer高。
PS：如果想追究清楚他们之间具体细节差异，麻烦自己查看实现源码即可

2.2 Android应用HashMap与ArrayMap及SparseArray优化建议
在Android开发中涉及到数据逻辑部分大部分用的都是Java的API（譬如HashMap），但是对于Android设备来说有些Java的API并不适合，可能会导致系统性能下降，好在Google团队已经意识到这些问题，所以他们针对Android设备对Java的一些API进行了优化，优化最多就是使用了ArrayMap及SparseArray替代HashMap来获得性能提升。

HashMap：
HashMap内部使用一个默认容量为16的数组来存储数据，数组中每一个元素存放一个链表的头结点，其实整个HashMap内部结构就是一个哈希表的拉链结构。HashMap默认实现的扩容是以2倍增加，且获取一个节点采用了遍历法，所以相对来说无论从内存消耗还是节点查找上都是十分昂贵的。

SparseArray：
SparseArray比HashMap省内存是因为它避免了对Key进行自动装箱（int转Integer），它内部是用两个数组来进行数据存储的（一个存Key，一个存Value），它内部对数据采用了压缩方式来表示稀疏数组数据，从而节约内存空间，而且其查找节点的实现采用了二分法，很明显可以看见性能的提升。

ArrayMap：
ArrayMap内部使用两个数组进行数据存储，一个记录Key的Hash值，一个记录Value值，它和SparseArray类似，也会在查找时对Key采用二分法。
有了上面的基本了解我们可以得出结论供开发时参考，当数据量不大（千位级内）且Key为int类型时使用SparseArray替换HashMap效率高；当数据量不大（千位级内）且数据类型为Map类型时使用ArrayMap替换HashMap效率高；其他情况下HashMap效率相对高于二者

2.3 Android应用ContentProviderOperation优化建议
ContentProvider是Android应用开发的核心组件之一，有时候在开发中需要使用ContentProvider对多行数据进行操作，我们的做法一般是多次调运相关操作方法，殊不知这种实现方式是非常低性能的，取而代之的做法应该是使用批量操作，具体为了使批量更新、插入、删除数据操作更加方便官方提供了ContentProviderOperation工具类。所以在我们开发中遇到类似情景时请务必使用批量操作，具体的优势如下：
所有的操作都在一个事务中执行，可以保证数据的完整性。
批量操作在一个事务中执行，所以只用打开、关闭一个事务。
减轻应用程序与ContentProvider间的多次频繁交互，提升性能。
可以看见，这对于数据库操作来说是一个非常有用的优化措施，烦请务必重视（我们项目优化过，的确有很大提升）

2.4 其他逻辑优化
避免在Android中使用Java的枚举类型，因为编译后不但占空间，加载也费时，完全没有static final的变量好用、高效。

Handler发送消息时尽量使用obtain去获取已经存在的Message对象进行复用，而不是新new Message对象，这样可以减轻内存压力。

在使用后台Service时尽量将能够替换为IntentService的地方替换为此，这样可以减轻系统压力、省电、省内存、省CPU占用率。

在当前类内部尽量不要通过自己的getXXX、setXXX对自己内部成员进行操作，而是直接使用，这样可以提高代码执行效率。

不要一味的为了设计模式而过分的抽象代码，因为代码抽象系数与代码加载执行时间成正比。

尽量减少锁个数、减小锁范围，避免造成性能问题。

合理的选择使用for循环与增强型for循环，譬如不要在ArrayList上使用增强型for循环等。
</code></pre><p>3、 Android UI性能优化方案</p>
<p>4、 设计模式</p>
<p>5、 Android网络访问框架选型和优化</p>
<pre><code>5.1 volley
5.2 retrofit
5.3 andrid-async-http
</code></pre><p>6、 Bug解决系统：Bugly；BugTags；GT；iTest；Emmagee；</p>
<p>7、 Android应用移动设备电池耗电性能分析</p>
<p>有了UI性能优化、内存性能优化、代码编写优化之后我们在来说说应用开发中很重要的一个优化模块—–电量优化。</p>
<p>7.1 Android应用耗电量概念</p>
<p>在盒子等开发时可能电量优化不是特别重视（视盒子待机真假待机模式而定），但是在移动设备开发中耗电量是一个非常重要的指标，如果用户一旦发现我们的应用非常耗电，不好意思，他们大多会选择卸载来解决此类问题，所以耗电量是一个十分重要的问题。</p>
<p>关于我们应用的耗电量情况我们可以进行定长时间测试，至于具体的耗电量统计等请参考此文，同时我们还可以直接通过Battery Historian Tool来查看详细的应用电量消耗情况。最简单常用办法是通过命令直接查看，如下：</p>
<p>adb shell dumpsys batterystats</p>
<p>其实我们一款应用耗电量最大的部分不是UI绘制显示等，常见耗电量最大原因基本都是因为网络数据交互、GPS定位、大量内存性能问题、冗余的后台线程和Service等造成。</p>
<p>7.2 Android应用耗电量优化建议</p>
<p>优化电量使用情况我们不仅可以使用系统提供的一些API去处理，还可以在平时编写代码时就养成好的习惯。具体的一些建议如下：</p>
<p>在需要网络的应用中，执行某些操作前尽量先进行网络状态判断。</p>
<p>在网络应用传输中使用高效率的数据格式和解析方法，譬如JSON等。</p>
<p>在传输用户反馈或者下载OTA升级包等不是十分紧急的操作时尽量采用压缩数据进行传输且延迟到设备充电和WIFI状态时进行。</p>
<p>在有必要的情况下尽量通过PowerManager.WakeLock和JobScheduler来控制一些逻辑操作达到省电优化。</p>
<p>对定位要求不太高的场景尽量使用网络定位，而不是GPS定位。</p>
<p>对于定时任务尽量使用AlarmManager，而不是sleep或者Timer进行管理。</p>
<p>尽可能的减少网络请求次数和减小网络请求时间间隔。</p>
<p>后台任务要尽可能少的唤醒CPU，譬如IM通信的长连接心跳时间间隔、一些应用的后台定时唤醒时间间隔等要设计合理。</p>
<p>特殊耗电业务情况可以进行弹窗等友好的交互设计提醒用户该操作会耗用过多电量。</p>
<p>可以看见，上面只是一些常见的电量消耗优化建议。总之，作为应用开发者的我们要意识到电量损耗对于用户来说是非常敏感的，只有我们做到合理的电量优化才能赢得用户的芳心。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://lichong951.github.io/2017/04/22/handler-framework/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lichong">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lc">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/22/handler-framework/" itemprop="url">Handler机制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-22T08:37:31+08:00">
                2017-04-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#Handler机制</p>
<p>##Message结构分析<br>Handler部分源码：</p>
<pre><code>    private boolean enqueueMessage(MessageQueue queue, Message msg, long uptimeMillis) {
    msg.target = this;
    if (mAsynchronous) {
        msg.setAsynchronous(true);
    }
    return queue.enqueueMessage(msg, uptimeMillis);
}
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://lichong951.github.io/2017/04/12/framework-imageloader/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lichong">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lc">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/12/framework-imageloader/" itemprop="url">网络图片加载工具</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-12T19:58:32+08:00">
                2017-04-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="《Android-Universal-Image-Loader》"><a href="#《Android-Universal-Image-Loader》" class="headerlink" title="《Android-Universal-Image-Loader》"></a>《Android-Universal-Image-Loader》</h2><h5 id="1、-数据结构分析"><a href="#1、-数据结构分析" class="headerlink" title="1、 数据结构分析"></a>1、 数据结构分析</h5><pre><code>/** Stores not strong references to objects */
private final Map&lt;String, Reference&lt;Bitmap&gt;&gt; softMap = Collections.synchronizedMap(new HashMap&lt;String, Reference&lt;Bitmap&gt;&gt;());

private final List&lt;Bitmap&gt; hardCache = Collections.synchronizedList(new LinkedList&lt;Bitmap&gt;());
</code></pre><p>LinkedHashMap中的get()方法不仅返回所匹配的值，并且在返回前还会将所匹配的key对应的entry调整在列表中的顺序（LinkedHashMap使用双链表来保存数据），让它处于列表的最后。当然，这种情况必须是在LinkedHashMap中accessOrder==true的情况下才生效的，反之就是get()方法不会改变被匹配的key对应的entry在列表中的位置</p>
<p>LinkedHashMap:</p>
<pre><code>根据链表中元素的顺序可以分为：按插入顺序的链表，和按访问顺序(调用get方法)的链表。  

默认是按插入顺序排序，如果指定按访问顺序排序，那么调用get方法后，会将这次访问的元素移至链表尾部，不断访问可以形成按访问顺序排序的链表。  可以重写removeEldestEntry方法返回true值指定插入元素时移除最老的元素。 
</code></pre><h5 id="2、-缓存策略分析"><a href="#2、-缓存策略分析" class="headerlink" title="2、 缓存策略分析"></a>2、 缓存策略分析</h5><p>UIL中的内存缓存策略</p>
<pre><code>1. 只使用的是强引用缓存 

LruMemoryCache（这个类就是这个开源框架默认的内存缓存类，缓存的是bitmap的强引用，下面我会从源码上面分析这个类）
 2.使用强引用和弱引用相结合的缓存有

 UsingFreqLimitedMemoryCache（如果缓存的图片总量超过限定值，先删除使用频率最小的bitmap）

LRULimitedMemoryCache（这个也是使用的lru算法，和LruMemoryCache不同的是，他缓存的是bitmap的弱引用）
FIFOLimitedMemoryCache（先进先出的缓存策略，当超过设定值，先删除最先加入缓存的bitmap）
LargestLimitedMemoryCache(当超过缓存限定值，先删除最大的bitmap对象)
LimitedAgeMemoryCache（当 bitmap加入缓存中的时间超过我们设定的值，将其删除）
 3.只使用弱引用缓存

 WeakMemoryCache（这个类缓存bitmap的总大小没有限制，唯一不足的地方就是不稳定，缓存的图片容易被回收掉）
</code></pre><p>我们直接选择UIL中的默认配置缓存策略进行分析。</p>
<p>ImageLoaderConfiguration config = ImageLoaderConfiguration.createDefault(context);<br>ImageLoaderConfiguration.createDefault(…)这个方法最后是调用Builder.build()方法创建默认的配置参数的。默认的内存缓存实现是LruMemoryCache，磁盘缓存是UnlimitedDiscCache。</p>
<p>业务如下</p>
<pre><code>① UI：请求数据，使用唯一的Key值索引Memory Cache中的Bitmap。

② 内存缓存：缓存搜索，如果能找到Key值对应的Bitmap，则返回数据。否则执行第三步。

③ 硬盘存储：使用唯一Key值对应的文件名，检索SDCard上的文件。

④ 如果有对应文件，使用BitmapFactory.decode*方法，解码Bitmap并返回数据，同时将数据写入缓存。如果没有对应文件，执行第五步。

⑤ 下载图片：启动异步线程，从数据源下载数据(Web)。

⑥ 若下载成功，将数据同时写入硬盘和缓存，并将Bitmap显示在UI中。
</code></pre><h5 id="3、-设计模式应用分析"><a href="#3、-设计模式应用分析" class="headerlink" title="3、 设计模式应用分析"></a>3、 设计模式应用分析</h5><ol>
<li>单例模式的应用在</li>
<li>builder模式</li>
</ol>
<h5 id="4、-线程池"><a href="#4、-线程池" class="headerlink" title="4、 线程池"></a>4、 线程池</h5><p>线程池能够带来三个好处：</p>
<pre><code>第一：降低资源消耗。通过重复利用已创建的线程降低线程创建和销毁造成的消耗
第二：提高响应速度。当任务到达时，任务可以不需要等到线程创建就能立即执行
第三：提高线程的可管理性。线程是稀缺资源，如果无限制的创建，不仅会消耗系统资源，还会降低系统的稳定性，使用线程池可以进行统一的分配，调优和监控
</code></pre><p><strong>创建一个ThreadPoolExecutor需要的参数：</strong></p>
<pre><code>corePoolSize（线程池的基本大小）：当提交一个任务到线程池时，线程池会创建一个线程来执行任务，即使其他空闲的基本线程能够执行新任务也会创建线程，等到需要执行的任务数大于线程池基本大小时就不再创建。如果调用了线程池的prestartAllCoreThreads方法，线程池会提前创建并启动所有基本线程。

runnableTaskQueue（任务队列）：用于保存等待执行的任务的阻塞队列。 可以选择以下几个阻塞队列。

ArrayBlockingQueue：是一个基于数组结构的有界阻塞队列，此队列按 FIFO（先进先出）原则对元素进行排序。

LinkedBlockingQueue：一个基于链表结构的阻塞队列，此队列按FIFO （先进先出） 排序元素，吞吐量通常要高于ArrayBlockingQueue。静态工厂方法Executors.newFixedThreadPool()使用了这个队列。

SynchronousQueue：一个不存储元素的阻塞队列。每个插入操作必须等到另一个线程调用移除操作，否则插入操作一直处于阻塞状态，吞吐量通常要高于LinkedBlockingQueue，静态工厂方法Executors.newCachedThreadPool使用了这个队列。

PriorityBlockingQueue：一个具有优先级的无限阻塞队列。

maximumPoolSize（线程池最大大小）：线程池允许创建的最大线程数。如果队列满了，并且已创建的线程数小于最大线程数，则线程池会再创建新的线程执行任务。值得注意的是如果使用了无界的任务队列这个参数就没什么效果。

ThreadFactory：用于设置创建线程的工厂，可以通过线程工厂给每个创建出来的线程设置更有意义的名字。

RejectedExecutionHandler（饱和策略）：当队列和线程池都满了，说明线程池处于饱和状态，那么必须采取一种策略处理提交的新任务。这个策略默认情况下是AbortPolicy，表示无法处理新任务时抛出异常。以下是JDK1.5提供的四种策略。
    # AbortPolicy：直接抛出异常。
    # CallerRunsPolicy：只用调用者所在线程来运行任务。
    # DiscardOldestPolicy：丢弃队列里最近的一个任务，并执行当前任务。
    # DiscardPolicy：不处理，丢弃掉。
当然也可以根据应用场景需要来实现RejectedExecutionHandler接口自定义策略。如记录日志或持久化不能处理的任务。

keepAliveTime（线程活动保持时间）：线程池的工作线程空闲后，保持存活的时间。所以如果任务很多，并且每个任务执行的时间比较短，可以调大这个时间，提高线程的利用率。

TimeUnit（线程活动保持时间的单位）：可选的单位有天（DAYS），小时（HOURS），分钟（MINUTES），毫秒(MILLISECONDS)，微秒(MICROSECONDS, 千分之一毫秒)和毫微秒(NANOSECONDS, 千分之一微秒)。
</code></pre><p><strong>用Executors静态工厂方法创建的线程池类型：</strong></p>
<pre><code>a) newFixedThreadPool：创建一个定长的线程池。达到最大线程数后，线程数不再增长。如果一个线程由于非预期Exception而结束，线程池会补充一个新的线程。

b) newCachedThreadPool：创建一个可缓存的线程池。当池长度超过处理需求时，可以回收空闲的线程。

c) newSingleThreadPool：创建一个单线程executor。

d) newScheduledThreadPool：创建一个定长的线程池，而且支持定时的以及周期性的任务执行。类似于Timer。但是，Timer是基于绝对时间，对系统时钟的改变是敏感的，而ScheduledThreadPoolExecutor只支持相对时间。
     1) Timer是创建唯一的线程来执行所有的timer任务。如果一个任务超时了，会导致其他的TimerTask时间准确性出问题。
     2）如果TimerTask抛出uncheck 异常，Timer将会产生无法预料的行为。因此，ScheduledThreadPoolExecutor可以完全代替Timer。
</code></pre><p><strong>合理的配置线程池</strong></p>
<pre><code>要想合理的配置线程池，就必须首先分析任务特性，可以从以下几个角度来进行分析：

任务的性质：CPU密集型任务，IO密集型任务和混合型任务。
任务的优先级：高，中和低。
任务的执行时间：长，中和短。
任务的依赖性：是否依赖其他系统资源，如数据库连接。

任务性质不同的任务可以用不同规模的线程池分开处理。CPU密集型任务配置尽可能小的线程，如配置Ncpu+1个线程的线程池。IO密集型任务则由于线程并不是一直在执行任务，则配置尽可能多的线程，如2*Ncpu。混合型的任务，如果可以拆分，则将其拆分成一个CPU密集型任务和一个IO密集型任务，只要这两个任务执行的时间相差不是太大，那么分解后执行的吞吐率要高于串行执行的吞吐率，如果这两个任务执行时间相差太大，则没必要进行分解。我们可以通过Runtime.getRuntime().availableProcessors()方法获得当前设备的CPU个数。

优先级不同的任务可以使用优先级队列PriorityBlockingQueue来处理。它可以让优先级高的任务先得到执行，需要注意的是如果一直有优先级高的任务提交到队列里，那么优先级低的任务可能永远不能执行。

执行时间不同的任务可以交给不同规模的线程池来处理，或者也可以使用优先级队列，让执行时间短的任务先执行。

依赖数据库连接池的任务，因为线程提交SQL后需要等待数据库返回结果，如果等待的时间越长CPU空闲时间就越长，那么线程数应该设置越大，这样才能更好的利用CPU。

建议使用有界队列，有界队列能增加系统的稳定性和预警能力，可以根据需要设大一点，比如几千。有一次我们组使用的后台任务线程池的队列和线程池全满了，不断的抛出抛弃任务的异常，通过排查发现是数据库出现了问题，导致执行SQL变得非常缓慢，因为后台任务线程池里的任务全是需要向数据库查询和插入数据的，所以导致线程池里的工作线程全部阻塞住，任务积压在线程池里。如果当时我们设置成无界队列，线程池的队列就会越来越多，有可能会撑满内存，导致整个系统不可用，而不只是后台任务出现问题。当然我们的系统所有的任务是用的单独的服务器部署的，而我们使用不同规模的线程池跑不同类型的任务，但是出现这样问题时也会影响到其他任务。
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://lichong951.github.io/2017/03/30/arithmetic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lichong">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lc">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/30/arithmetic/" itemprop="url">算法（java版）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-30T21:43:22+08:00">
                2017-03-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h2><pre><code>public static void bubbleSort(int[] a) {
    if (a == null) {
        return;
    }

    for (int i = 0; i &lt; a.length; i++) {
        for (int j = a.length - 1; j &gt; i; j--) {
            if (a[j - 1] &gt; a[j]) {
                int temp = a[j];
                a[j] = a[j - 1];
                a[j - 1] = temp;
            }

        }
    }

    for (int i = 0; i &lt; a.length; i++) {
        System.out.println(a[i]);
    }
}
</code></pre><h2 id="朴素模式匹配算法"><a href="#朴素模式匹配算法" class="headerlink" title="朴素模式匹配算法"></a>朴素模式匹配算法</h2><pre><code>//朴素模式匹配算法
    public static int index(String s,String t,int pos){
    int i=pos;//主串中第几个位置开始比较
    int j=0;//模式串中的第一个位置
    while(i&lt;s.length()&amp;&amp;j&lt;t.length()){
        if(s.charAt(i)==t.charAt(j)){
            i++;
            j++;
        }else{
            i=i-j+1;//主串的下一个位置
            j=0;//继续第一个位置
        }
    }
    if(j&gt;=t.length()){
        return i-t.length();
    }else{
        return -1;
    }
}
</code></pre><h2 id="KMP模式匹配算法"><a href="#KMP模式匹配算法" class="headerlink" title="KMP模式匹配算法"></a>KMP模式匹配算法</h2><pre><code>//////////KMP模式匹配算法////////////////
    public static int[] getNext(String t){
        System.out.println(t);
        int[] next=new int[t.length()];
        int i=1;
        int j=0;

        next[i]=j;

        while(i&lt;t.length()-1){

            if(j==0||t.charAt(i)==t.charAt(j)){
//                System.out.print(&quot;i=&quot;+i+&quot; &quot;+t.charAt(i)+&quot;、&quot;);
//                System.out.print(&quot;j=&quot;+j+&quot; &quot;+t.charAt(j)+&quot;;&quot;);
                i++;
                j++;
                next[i]=j;
            }else{
                System.out.println();
                j=next[j];//若字符不相等，则j值进行回溯。
            }

        }
        System.out.println();
        for(int k=0;k&lt;next.length;k++){
            System.out.print(next[k]);
        }
        System.out.println();
        return next;
    }

    public static int indexKMP(String s,String t,int pos){
        int i=pos;//表示从主串中第几个字符串开始匹配
        int j=0;//表示从模式串中第几个字符串开始
        int[] next=getNext(t);
        while(i&lt;s.length()&amp;&amp;j&lt;t.length()){
            if(j==0||s.charAt(i)==t.charAt(j)){
                i++;
                j++;
            }else{
                j=next[j];
            }
        }
        if(j&gt;=t.length()){
            return i-t.length();
        }else{
            return 0;
        }

    }
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">lichong</p>
              <p class="site-description motion-element" itemprop="description">读书笔记；移动开发；node.js</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lichong</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
